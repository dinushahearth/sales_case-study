{
	"name": "SCD Type 1",
	"properties": {
		"content": {
			"query": "------------------------------------------------------------------------------------------------------------------------------------------------------------\n\n---Insert new records\nINSERT INTO Sales.dimCustomers\nSELECT *\nFROM Sales.ExCustomers as stg\nWHERE NOT EXISTS(\n    SELECT *\n    FROM Sales.dimCustomers AS dim WHERE dim.Customer_Name = stg.Customer_Name\n)\n\n---SCD Type 1\nUPDATE Sales.dimCustomers\nSET dim.Customer_Name = stg.Customer_Name,\n    dim.Phone =  stg.Phone ,\n    dim.Address_Line1 =  stg.Address_Line1,\n    dim.Address_Line2 =  stg.Address_Line2,\n    dim.City =  stg.City, \n    dim.State =  stg.State, \n    dim.Postal_Code =  stg.Postal_Code,\n    dim.Country =  stg.Country, \n    dim.Territory =  stg.Territory, \n    dim.Contact_Lastname =  stg.Contact_Lastname,\n    dim.Conact_Firstname =  stg.Conact_Firstname\nFROM Sales.dimCustomers AS dim INNER JOIN Sales.ExCustomers AS stg\nON dim.Customer_Name = stg.Customer_Name\nWHERE dim.Phone <> stg.Phone \nOR dim.Address_Line1 <> stg.Address_Line1 \nOR dim.Address_Line2 <> stg.Address_Line2\nOR dim.City <> stg.City \nOR dim.State <> stg.State \nOR dim.Postal_Code <> stg.Postal_Code\nOR dim.Country <> stg.Country \nOR dim.Territory <> stg.Territory \nOR dim.Contact_Lastname <> stg.Contact_Lastname\nOR dim.Conact_Firstname <> stg.Conact_Firstname\n\nALTER INDEX ALL ON  Sales.dimCustomers REBUILD\n------------------------------------------------------------------------------------------------------------------------------------------------------------\n\n\nINSERT INTO Sales.dimOrderDate\nSELECT *\nFROM Sales.ExOrderDate AS stg\nWHERE NOT EXISTS(\n    SELECT *\n    FROM Sales.dimOrderDate AS dim WHERE dim.Order_Number = stg.Order_Number \n)\n\nUPDATE Sales.dimOrderDate\nSET dim.Order_Date = stg.Order_Date,\n    dim.Status = stg.Status \nFROM Sales.dimOrderDate AS dim INNER JOIN Sales.dimOrderDate AS stg ON dim.Order_Number = stg.Order_Number \nWHERE dim.Order_Date <> stg.Order_Date OR dim.Status <> stg.Status \n\nALTER INDEX ALL ON Sales.dimOrderDate REBUILD\n\n------------------------------------------------------------------------------------------------------------------------------------------------------------\n\n\n\nINSERT INTO Sales.dimProducts\nSELECT *\nFROM Sales.ExProducts AS stg\nWHERE NOT EXISTS(\n    SELECT *\n    FROM Sales.dimProducts AS dim WHERE dim.Product_Code = stg.Product_Code\n)\n\nUPDATE Sales.dimProducts\nSET dim.MSRP = stg.MSRP,\n    dim.Product_Line = stg.Product_Line\nFROM Sales.dimProducts AS dim INNER JOIN Sales.ExProducts AS  stg ON dim.Product_Code = stg.Product_Code\nWHERE dim.MSRP <> stg.MSRP OR dim.Product_Line <> stg.Product_Line\n\nALTER INDEX ALL ON Sales.dimProducts REBUILD\n\n------------------------------------------------------------------------------------------------------------------------------------------------------------\n\n\nINSERT INTO Sales.dimSalesDeals\nSELECT *\nFROM Sales.ExSalesDeals AS stg\nWHERE NOT EXISTS(\n    SELECT *\n    FROM Sales.dimSalesDeals AS dim WHERE dim.Sales = stg.Sales\n)\n\nUPDATE Sales.dimSalesDeals\nSET dim.Deal_Size = stg.Deal_Size\nFROM Sales.dimSalesDealsAS dim INNER JOIN Sales.ExSalesDeals AS stg ON dim.Sales = stg.Sales\nWHERE dim.Deal_Size <> stg.Deal_Size \n\nALTER INDEX ALL ON Sales.dimSalesDeals REBUILD\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "sales_cg",
				"poolName": "sales_cg"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}